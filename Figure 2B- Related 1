####Code related to Fishers analysis comparing YAP1 post-stasis gene signature to stem cell related gene signatures



###Generic Intersect Function
#Read in list of Hematopoiesis StemUp genes
b <- read.table("Hematopoiesis_Stem_Ivanova2002.csv",
                sep=",", header=FALSE)
#Assign gene universe to variable a
a <- read.table("GeneUniverse_genesymbol.csv",
                sep=",", header=FALSE)
#Assign YapSignature genes to variable c
c <- read.table("PostStasisYapSignature_p05UpGenes_genesymbol.csv",
                sep=",", header=FALSE)

#Intersect Hematopoiesis StemUp genes with gene universe
a <- a [,1]
b <- b [,1]

#head(a,)

list1 <- intersect(a,b)
head(list1,)
length(list1)

length(a)
length(b)

#Intersect Hematopoiesis StemUp genes with PostStasisYapSignatureUp2
c <- c [,1]

list2 <- intersect(b,c)
head(list2,)
length(list2)

length(a)
length(b)
length(c)
length(list1)
length(list2)



### Generic Fisher/Odds ratio Test
#Hematopoetic stem cell Up genes and Post-stasis Yap Up genes

#Make matrix
Data <- matrix(c(10,373,149,17630),
               nrow = 2,
               dimnames = list(HeScGenesin = c("DEGenes","Non DE Genes"),
                               HeScGenesout = c("DEGenes","Non DE Genes")))
fisher.test(Data,alternative = "greater")

#p-value = 0.002045
#alternative hypothesis: true odds ratio is greater than 1
#95 percent confidence interval:
#  1.677091      Inf
#sample estimates:
#  odds ratio 
#3.171776 



### Plot using ggplot
library(ggplot2)
library(dplyr)
library(RColorBrewer)

#load in data
df <- read.csv("~/Desktop/RNAseq_Analyses/2021_08/2021_08_30/OddsRatio_PostStasisYap_GeneSigsofInterest_2.csv")

pdf("Post-stasisYapSignature_vs_StemCellSignatures_PvalGradient.pdf")

ggplot(df, aes(x=reorder(Gene_Signature,Odds_Ratio), y=Odds_Ratio, fill = P_value)) +
  
  geom_hline(yintercept = 1, color="magenta3", size=1.6) +
  geom_point(shape=21, size=4) +
  scale_fill_gradient2(limits = c(1.3,16), midpoint = 1.3, low = "white", mid ="white", high = "turquoise3", name=expression(paste("P value (-Log"[10], ")"))) +
  scale_size(name = expression("Number of Overlapping Genes"), breaks = c(2,35)/4, labels = expression(2,35)) +
  ylab("") + xlab("") + ylim(0,7) +
  theme_bw() + 
  theme(axis.text.x = element_text(size = 14)) +
  theme(axis.text.y = element_text(size = 16)) +
  theme(axis.title.x = element_text(size = 16)) +
  theme(legend.text=element_text(size=14)) +
  theme(aspect.ratio=3/2) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
  theme(panel.border = element_rect(colour = "black", fill=NA, size=1)) +
  coord_flip()

dev.off()
